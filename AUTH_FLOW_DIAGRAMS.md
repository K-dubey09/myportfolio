# ğŸ”„ Authentication Flow Diagrams

## 1. Login Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         LOGIN FLOW                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User                    Frontend                Backend              Database
  â”‚                        â”‚                       â”‚                    â”‚
  â”‚  Enter credentials     â”‚                       â”‚                    â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                       â”‚                    â”‚
  â”‚                        â”‚                       â”‚                    â”‚
  â”‚                        â”‚  POST /api/auth/login â”‚                    â”‚
  â”‚                        â”‚ {email, password}     â”‚                    â”‚
  â”‚                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                    â”‚
  â”‚                        â”‚                       â”‚                    â”‚
  â”‚                        â”‚                       â”‚  Validate user     â”‚
  â”‚                        â”‚                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                        â”‚                       â”‚                    â”‚
  â”‚                        â”‚                       â”‚  User found âœ“      â”‚
  â”‚                        â”‚                       â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                        â”‚                       â”‚                    â”‚
  â”‚                        â”‚                       â”‚  Generate tokens   â”‚
  â”‚                        â”‚                       â”‚  - Access (15m)    â”‚
  â”‚                        â”‚                       â”‚  - Refresh (30d)   â”‚
  â”‚                        â”‚                       â”‚                    â”‚
  â”‚                        â”‚                       â”‚  Save refresh      â”‚
  â”‚                        â”‚                       â”‚  token to DB       â”‚
  â”‚                        â”‚                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                        â”‚                       â”‚                    â”‚
  â”‚                        â”‚  Response:            â”‚  Saved âœ“           â”‚
  â”‚                        â”‚  - accessToken        â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                        â”‚  - user data          â”‚                    â”‚
  â”‚                        â”‚  Cookie: refreshToken â”‚                    â”‚
  â”‚                        â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚
  â”‚                        â”‚                       â”‚                    â”‚
  â”‚                        â”‚  Store in memory:     â”‚                    â”‚
  â”‚                        â”‚  - accessToken        â”‚                    â”‚
  â”‚                        â”‚  - user               â”‚                    â”‚
  â”‚                        â”‚  - isAuthenticated    â”‚                    â”‚
  â”‚                        â”‚                       â”‚                    â”‚
  â”‚  Logged in! âœ“          â”‚                       â”‚                    â”‚
  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                       â”‚                    â”‚
  â”‚                        â”‚                       â”‚                    â”‚
  â”‚                        â”‚  Start 10-min timer   â”‚                    â”‚
  â”‚                        â”‚  for auto-refresh     â”‚                    â”‚
  â”‚                        â”‚                       â”‚                    â”‚
```

## 2. Page Refresh / Initialization Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PAGE LOAD / REFRESH FLOW                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Browser                 Frontend                Backend              Database
  â”‚                        â”‚                       â”‚                    â”‚
  â”‚  Page loads            â”‚                       â”‚                    â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                       â”‚                    â”‚
  â”‚                        â”‚                       â”‚                    â”‚
  â”‚                        â”‚  AuthProvider init    â”‚                    â”‚
  â”‚                        â”‚  Check for session    â”‚                    â”‚
  â”‚                        â”‚                       â”‚                    â”‚
  â”‚                        â”‚  POST /api/auth/refresh                    â”‚
  â”‚                        â”‚  Cookie: refreshToken â”‚                    â”‚
  â”‚                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                    â”‚
  â”‚                        â”‚                       â”‚                    â”‚
  â”‚                        â”‚                       â”‚  Verify JWT        â”‚
  â”‚                        â”‚                       â”‚  signature         â”‚
  â”‚                        â”‚                       â”‚                    â”‚
  â”‚                        â”‚                       â”‚  Find user in DB   â”‚
  â”‚                        â”‚                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                        â”‚                       â”‚                    â”‚
  â”‚                        â”‚                       â”‚  User found âœ“      â”‚
  â”‚                        â”‚                       â”‚  Validate token    â”‚
  â”‚                        â”‚                       â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                        â”‚                       â”‚                    â”‚
  â”‚                        â”‚                       â”‚  Generate new      â”‚
  â”‚                        â”‚                       â”‚  tokens (rotate)   â”‚
  â”‚                        â”‚                       â”‚                    â”‚
  â”‚                        â”‚                       â”‚  Save new refresh  â”‚
  â”‚                        â”‚                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                        â”‚                       â”‚                    â”‚
  â”‚                        â”‚  Response:            â”‚  Saved âœ“           â”‚
  â”‚                        â”‚  - new accessToken    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                        â”‚  - user data          â”‚                    â”‚
  â”‚                        â”‚  Cookie: new refresh  â”‚                    â”‚
  â”‚                        â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚
  â”‚                        â”‚                       â”‚                    â”‚
  â”‚                        â”‚  Restore state:       â”‚                    â”‚
  â”‚                        â”‚  âœ“ accessToken        â”‚                    â”‚
  â”‚                        â”‚  âœ“ user               â”‚                    â”‚
  â”‚                        â”‚  âœ“ isAuthenticated    â”‚                    â”‚
  â”‚                        â”‚                       â”‚                    â”‚
  â”‚                        â”‚  Fetch user profile   â”‚                    â”‚
  â”‚                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                    â”‚
  â”‚                        â”‚                       â”‚                    â”‚
  â”‚                        â”‚  User profile         â”‚                    â”‚
  â”‚                        â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚
  â”‚                        â”‚                       â”‚                    â”‚
  â”‚                        â”‚  Start auto-refresh   â”‚                    â”‚
  â”‚                        â”‚  timer (10 min)       â”‚                    â”‚
  â”‚                        â”‚                       â”‚                    â”‚
  â”‚  Session restored âœ“    â”‚                       â”‚                    â”‚
  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                       â”‚                    â”‚
  â”‚                        â”‚                       â”‚                    â”‚
```

## 3. Auto-Refresh Flow (Every 10 Minutes)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      AUTO-REFRESH FLOW                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Timer                   Frontend                Backend              Database
  â”‚                        â”‚                       â”‚                    â”‚
  â”‚  10 minutes elapsed    â”‚                       â”‚                    â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                       â”‚                    â”‚
  â”‚                        â”‚                       â”‚                    â”‚
  â”‚                        â”‚  Trigger refresh      â”‚                    â”‚
  â”‚                        â”‚                       â”‚                    â”‚
  â”‚                        â”‚  POST /api/auth/refresh                    â”‚
  â”‚                        â”‚  Cookie: refreshToken â”‚                    â”‚
  â”‚                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                    â”‚
  â”‚                        â”‚                       â”‚                    â”‚
  â”‚                        â”‚                       â”‚  Validate token    â”‚
  â”‚                        â”‚                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                        â”‚                       â”‚                    â”‚
  â”‚                        â”‚                       â”‚  Valid âœ“           â”‚
  â”‚                        â”‚                       â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                        â”‚                       â”‚                    â”‚
  â”‚                        â”‚                       â”‚  Generate new      â”‚
  â”‚                        â”‚                       â”‚  tokens            â”‚
  â”‚                        â”‚                       â”‚                    â”‚
  â”‚                        â”‚                       â”‚  Rotate refresh    â”‚
  â”‚                        â”‚                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                        â”‚                       â”‚                    â”‚
  â”‚                        â”‚  New tokens           â”‚  Saved âœ“           â”‚
  â”‚                        â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                        â”‚                       â”‚                    â”‚
  â”‚                        â”‚  Update memory:       â”‚                    â”‚
  â”‚                        â”‚  accessToken = new    â”‚                    â”‚
  â”‚                        â”‚                       â”‚                    â”‚
  â”‚  Schedule next refresh â”‚                       â”‚                    â”‚
  â”‚  (10 min)              â”‚                       â”‚                    â”‚
  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                       â”‚                    â”‚
  â”‚                        â”‚                       â”‚                    â”‚
```

## 4. API Request Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AUTHENTICATED API REQUEST                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Component               Frontend                Backend              Database
  â”‚                        â”‚                       â”‚                    â”‚
  â”‚  Need data             â”‚                       â”‚                    â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                       â”‚                    â”‚
  â”‚                        â”‚                       â”‚                    â”‚
  â”‚                        â”‚  GET /api/projects    â”‚                    â”‚
  â”‚                        â”‚  Header: Authorizationâ”‚                    â”‚
  â”‚                        â”‚  Bearer <accessToken> â”‚                    â”‚
  â”‚                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                    â”‚
  â”‚                        â”‚                       â”‚                    â”‚
  â”‚                        â”‚                       â”‚  Verify JWT        â”‚
  â”‚                        â”‚                       â”‚  signature         â”‚
  â”‚                        â”‚                       â”‚                    â”‚
  â”‚                        â”‚                       â”‚  Decode token      â”‚
  â”‚                        â”‚                       â”‚  userId = ...      â”‚
  â”‚                        â”‚                       â”‚                    â”‚
  â”‚                        â”‚                       â”‚  Find user         â”‚
  â”‚                        â”‚                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                        â”‚                       â”‚                    â”‚
  â”‚                        â”‚                       â”‚  User exists âœ“     â”‚
  â”‚                        â”‚                       â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                        â”‚                       â”‚                    â”‚
  â”‚                        â”‚                       â”‚  Query projects    â”‚
  â”‚                        â”‚                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                        â”‚                       â”‚                    â”‚
  â”‚                        â”‚  Response: projects   â”‚  Data âœ“            â”‚
  â”‚                        â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                        â”‚                       â”‚                    â”‚
  â”‚  Display data          â”‚                       â”‚                    â”‚
  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                       â”‚                    â”‚
  â”‚                        â”‚                       â”‚                    â”‚
```

## 5. Logout Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          LOGOUT FLOW                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

User                    Frontend                Backend              Database
  â”‚                        â”‚                       â”‚                    â”‚
  â”‚  Click logout          â”‚                       â”‚                    â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                       â”‚                    â”‚
  â”‚                        â”‚                       â”‚                    â”‚
  â”‚                        â”‚  Clear auto-refresh   â”‚                    â”‚
  â”‚                        â”‚  timer                â”‚                    â”‚
  â”‚                        â”‚                       â”‚                    â”‚
  â”‚                        â”‚  POST /api/auth/logoutâ”‚                    â”‚
  â”‚                        â”‚  Header: accessToken  â”‚                    â”‚
  â”‚                        â”‚  Cookie: refreshToken â”‚                    â”‚
  â”‚                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                    â”‚
  â”‚                        â”‚                       â”‚                    â”‚
  â”‚                        â”‚                       â”‚  Find user by      â”‚
  â”‚                        â”‚                       â”‚  refresh token     â”‚
  â”‚                        â”‚                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                        â”‚                       â”‚                    â”‚
  â”‚                        â”‚                       â”‚  User found        â”‚
  â”‚                        â”‚                       â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                        â”‚                       â”‚                    â”‚
  â”‚                        â”‚                       â”‚  Clear refresh     â”‚
  â”‚                        â”‚                       â”‚  token fields      â”‚
  â”‚                        â”‚                       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
  â”‚                        â”‚                       â”‚                    â”‚
  â”‚                        â”‚  Response: success    â”‚  Cleared âœ“         â”‚
  â”‚                        â”‚  Clear cookie         â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                        â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚
  â”‚                        â”‚                       â”‚                    â”‚
  â”‚                        â”‚  Clear state:         â”‚                    â”‚
  â”‚                        â”‚  - accessToken = null â”‚                    â”‚
  â”‚                        â”‚  - user = null        â”‚                    â”‚
  â”‚                        â”‚  - isAuthenticated=0  â”‚                    â”‚
  â”‚                        â”‚                       â”‚                    â”‚
  â”‚  Logged out âœ“          â”‚                       â”‚                    â”‚
  â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                       â”‚                    â”‚
  â”‚                        â”‚                       â”‚                    â”‚
```

## 6. Token Expiry & Error Handling

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    TOKEN EXPIRY SCENARIO                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Scenario 1: Access Token Expired, Refresh Token Valid
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Request â†’ 401 Unauthorized
   â†“
Auto-refresh triggered
   â†“
New access token received
   â†“
Request retried with new token
   â†“
Success âœ“


Scenario 2: Both Tokens Expired
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Request â†’ 401 Unauthorized
   â†“
Auto-refresh attempted
   â†“
Refresh fails (token expired)
   â†“
Clear all auth state
   â†“
Redirect to login
   â†“
User must login again


Scenario 3: Invalid Refresh Token
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Auto-refresh triggered
   â†“
Backend validation fails
   â†“
401 Invalid refresh token
   â†“
Frontend receives error
   â†“
Logout user
   â†“
Redirect to login
```

## 7. Security Layers

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       SECURITY LAYERS                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Layer 1: HttpOnly Cookie
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Refresh token in cookie       â”‚
â”‚  âœ“ Can't access via JavaScript â”‚
â”‚  âœ“ Protected from XSS          â”‚
â”‚  âœ“ Sent automatically          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
Layer 2: Token Rotation
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  New token on every refresh    â”‚
â”‚  âœ“ Old token invalidated       â”‚
â”‚  âœ“ Limited window for theft    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
Layer 3: Database Validation
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Check token against DB        â”‚
â”‚  âœ“ Detect stolen tokens        â”‚
â”‚  âœ“ Force logout possible       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
Layer 4: Short Access Token Life
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Access token expires in 15m   â”‚
â”‚  âœ“ Limited exposure window     â”‚
â”‚  âœ“ Must refresh often          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
Layer 5: Secure Cookie Settings
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  secure: true (HTTPS only)     â”‚
â”‚  sameSite: strict (CSRF)       â”‚
â”‚  path: /api/auth (limited)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 8. State Management

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   AUTHCONTEXT STATE FLOW                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Initial State
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ loading: true        â”‚
â”‚ isAuthenticated: 0   â”‚
â”‚ user: null           â”‚
â”‚ token: null          â”‚
â”‚ refreshInterval: nullâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
    Try Refresh
          â”‚
          â”œâ”€ Success â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> Authenticated State
          â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                         â”‚ loading: false       â”‚
          â”‚                         â”‚ isAuthenticated: 1   â”‚
          â”‚                         â”‚ user: {...}          â”‚
          â”‚                         â”‚ token: "jwt..."      â”‚
          â”‚                         â”‚ refreshInterval: id  â”‚
          â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                                    â”‚
          â”‚                                    â–¼
          â”‚                              Auto-refresh
          â”‚                              every 10 min
          â”‚                                    â”‚
          â”‚                                    â–¼
          â”‚                              Stay authenticated
          â”‚
          â””â”€ Fail â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> Unauthenticated State
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚ loading: false       â”‚
                                    â”‚ isAuthenticated: 0   â”‚
                                    â”‚ user: null           â”‚
                                    â”‚ token: null          â”‚
                                    â”‚ refreshInterval: nullâ”‚
                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Timeline Comparison

### Without Persistent Sessions:
```
0:00  â”‚ Login
0:01  â”‚ User works
0:05  â”‚ Page refresh â†’ LOGOUT âŒ
0:06  â”‚ Must login again
```

### With Persistent Sessions:
```
Day 1, 0:00  â”‚ Login
      0:01  â”‚ User works
      0:05  â”‚ Page refresh â†’ STILL LOGGED IN âœ…
      0:10  â”‚ Auto-refresh (silent)
      0:15  â”‚ User works
      1:00  â”‚ Close browser
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Day 2, 9:00  â”‚ Open browser â†’ STILL LOGGED IN âœ…
      9:10  â”‚ Auto-refresh (silent)
      9:30  â”‚ User works
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Day 30       â”‚ Session expires
      0:01  â”‚ Must login again
```

---

**Visual representations help understand the complete authentication flow!** ğŸ“Šâœ¨
